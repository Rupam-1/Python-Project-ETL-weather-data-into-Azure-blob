<h1 align="center">Weather data ETL</h1>
<p align="center">
  <a href="http://temp-url.com" target="_blank">
    <img alt="Documentation" src="https://img.shields.io/badge/documentation-yes-brightgreen.svg" />
  </a>
</p>

> This repository features Python scripts designed to streamline the process of obtaining current weather data from a weather API and storing it in Azure Blob Storage.
> The scripts handle the entire workflow:
> 1. Data Extraction: Fetches real-time weather information from a specified API.
> 2. Data Transform: Converts the raw data into a clean, consistent format suitable for analysis or storage.
> 3. Data Loading: Uploads the extracted-transformed data to Azure Blob Storage for easy access and management.

# Features

- **API Integration**: Retrieve data from RESTful APIs, supporting both authenticated and unauthenticated endpoints with configurable request settings.
- **Data Transformation**: Convert and clean the raw weather data to make it suitable for analysis or storage.
- **Azure Blob Storage**: Seamlessly upload and manage weather data in Azure Blob Storage.
- **Modular and Extensible**: The script is designed to be modular and easily extendable, allowing for straightforward integration with other systems or enhancements.
- **Error Handling & Logging**: Includes robust error handling and logging to ensure reliability and simplify troubleshooting.

# Contents

1. [Code Layout](#code-layout)
2. [Dependencies](#dependencies)
3. [Run Steps](#run-steps)
4. [Configuration Options](#configuration-options)
5. [Run Schedules](#run-schedules)
6. [Script Execution and Logging](#script-execution-and-logging)
7. [Change Process](#change-process)

# Code Layout

```plaintext
Weather-data-ETL
â”œâ”€â”€ config.ini  # Store credentials and configuration options.
â”œâ”€â”€ weather-etl.py  # The main entry point for the ETL process.
â”œâ”€â”€ helpers
|   â”œâ”€â”€ weather-data  # contains log files for troubleshooting any error(if any)
|   â”œâ”€â”€ __init__.py  # Initialize helper modules.
â”‚   â”œâ”€â”€ azure_blob_client.py  # Helper module for Azure Blob storage interactions.
â”‚   â”œâ”€â”€ create_file_helper.py  # Helper module for creating CSV or JSON files.
â”‚   â”œâ”€â”€ logging_client.py  # Logger utilities.
â”‚   â”œâ”€â”€ weather_client.py  # Helper module for data fetching from API.
â”œâ”€â”€ README.md  # Project documentation.
â””â”€â”€ requirements.txt  # Python dependencies.

1 directory, 13 files
```
# Dependencies

1. Python 3.x
2. A configuration file (`config.ini`) that includes Azure storage account credentials and other necessary settings.
3. Config files are saved locally and kept hidden here as those are confidential.

# Run Steps

```bash
# Optional: create a virtual environment
python -m venv venv

# Install required libraries
python -m pip install -r requirements.txt

# Run the main file
python weather-etl.py
```

# Configuration options <a id="config"></a>

The `config.ini` file should include the following configuration options:

```ini
[environment]
dry_run = False  # Set to True for a dry run (no data is written to Azure). Set to False for actual data processing.
account = dev   # Set to dev or prod, to run in dev or prod environment

[weather_creds]
api_key = <api_key>  # API key for accessing weather data.
weather_url = <api_url>  # URL of the weather API endpoint.
lat = <latitude>  # Latitude for weather data retrieval.
lon = <longitude>  # Longitude for weather data retrieval.
units = <units>  # Units of measurement (e.g., 'metric' for Celcius or 'imperial' for Farenheit).

[azure_blob_dev]
storage_account_key = <azure_storage_account_key>  # development Azure storage account key.
storage_account_name = <azure_storage_account_name>  # development Azure storage account name.
storage_account_url = <azure_storage_account_url>  # development Azure storage account URL.
container_name = dummy-test  # The name of the container in Azure Blob storage for development.

[csv_config]
write_csv = True  # Set to True to enable writing data to CSV files.
csv_file_path = ./files  # Local path where CSV files will be stored.
clean_files = True  # Set to True to clean up old files before writing new ones.
upload_files = True  # Set to True to enable uploading CSV files to Azure Blob storage.


```
# Run schedules <a id="runs"></a>
This script runs once everyday.
```
# example of cronjob
5 4 * * *
```
# Script Execution and Logging
The script is scheduled to run automatically via a cron job.
- **Trigger Path**: The script is triggered from `/opt/ihsm/scheduler`
- **Log Directory**: Logs generated by the script are stored inside the repo directory locally.

Ensure that the cron job is properly configured and that the log directory has the necessary permissions for writing logs.

# Change Process

Follow the steps below for making any changes to the project:

1. **Create a Work Item**:
   - Before making any changes, create a work item on the project board to track the task or feature you are working on.

2. **Create a Feature Branch**:
   - Create a new feature branch based on the work item number. The branch name should follow the format:
     ```
     git checkout -b feature_branch/<workitem_number>
     ```
   - Example:
     ```
     git checkout -b feature_branch/1234
     ```

3. **Make Your Changes**:
   - Implement the necessary changes in your feature branch. 

4. **Commit Your Changes**:
   - Once the changes are complete, commit them with a meaningful commit message that references the work item:
     ```bash
     git add .
     git commit -m "Fix something (Work Item #1234)"
     ```
5. **Push the Feature Branch**:
   - Push your feature branch to the remote repository:
     ```bash
     git push -u origin feature_branch/<workitem_number>
     ```
   - Example:
     ```bash
     git push -u origin feature_branch/1234
     ```

6. **Create a Pull Request**:
   - After pushing your branch, create a pull request (PR) for the feature branch. Ensure the PR description includes relevant details about the changes and references the work item.

7. **Code Review and Approval**:
   - The pull request must be reviewed and approved by another team member before it can be merged into the main branch. Address any feedback received during the review process.

8. **Merge the Feature Branch**:
   - Once the PR is approved, merge the feature branch into the main branch. Ensure all checks and tests have passed before merging.

9. **Update Your Local Branch**:
   - After your pull request has been merged into the `main` or `master` branch, update your local branch on [ETL](#script-execution-and-logging) servers to reflect the latest changes:
     ```bash
     git checkout main
     git pull origin main
     ```
   - This ensures your local repository is synchronized with the remote repository, including the latest merged changes.

10. **Close the Work Item**:
   - After the feature branch is successfully merged and pulled locally, close the associated work item on the project board.

Following this process ensures that all changes are properly tracked, reviewed, and integrated, maintaining the integrity and quality of the codebase.

ðŸ‘¤ **Rupam Patwari**

* Email: [patwarirupam@gmail.com](patwarirupam@gmail.com)
